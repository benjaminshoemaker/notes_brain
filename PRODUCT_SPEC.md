# NotesBrain Product Specification

## Overview

NotesBrain is a frictionless note capture system with AI-powered classification and daily summaries. The core insight: the magic isn't storage—it's the AI loop that classifies, organizes, and surfaces information while you're not thinking about it.

**Platforms:** Android mobile app (primary) + Web application (secondary)

**Target User:** Single user (the developer) who captures many thoughts, tasks, and ideas throughout the day and wants them automatically organized and surfaced.

**Platform Roles:**
- **Mobile:** Primary interface for capture + receives daily summary push notifications
- **Web:** View, organize, search, and bulk file uploads. No proactive notifications.

---

## Problem Statement

Information capture is fragmented across apps, voice memos, and mental notes. Without a system, valuable thoughts get lost, tasks slip through cracks, and there's no proactive nudge to act on what matters.

Current workarounds (dumping into Claude Projects, scattered notes apps) lack:
- Automatic organization
- Proactive daily summaries
- A unified view across capture methods

---

## Core User Experience

### Capture (Android)

| Method | Flow |
|--------|------|
| **App open** | Immediately lands on text input (zero friction) |
| **Voice** | Tap mic → record (max 5 min) → async transcribe → async categorize → save |
| **Share sheet** | Receive files/text/links from other apps. Text/links auto-categorized; files prompt for optional category selection |
| **Widget** | Home screen quick-capture (text only) |

Capture is synchronous (note saved immediately). Classification happens async (1-3 seconds background job).

### Capture (Web)

| Method | Flow |
|--------|------|
| **Drag-and-drop** | Drop files (PDF, images, docs) into zone. Optional category selection; no category → uncategorized |
| **Text input** | Type or paste → auto-categorized |
| **Paste anything** | Auto-detects URLs, images, text |

### View & Organize (Web)

- Reverse-chronological feed (default view)
- Filter by category
- Full-text search
- Inline preview for attachments
- Manual category editing: tap category badge to change (single interaction)

### Daily Summary (Mobile Push Notification)

Delivered at **8:00 AM user's local time** via push notification to the mobile app.

**Note:** Daily summary requires the mobile app. Web-only users do not receive proactive summaries (email fallback is post-MVP).

**Content (generated by LLM from the past 48 hours of notes):**
1. **Top 3 actions** for today (concrete, executable—not "work on website" but "email Sarah about copy deadline")
2. **One thing you might be avoiding** (pattern detection from what keeps resurfacing)
3. **One small win to notice** (something you captured or progressed on)

Format fits in expanded push notification. Tap opens full summary in app.

**Generation:** Scheduled cron job at ~7:55am generates and caches the summary. Push sent at 8:00am with pre-generated content for instant load.

**MVP Clarification (to keep scope small):**
- There is no explicit "open task list" or "done" state in MVP.
- The daily summary only uses notes in the past 48 hours. Anything older is out of context by design.
- Post-MVP can introduce explicit task states (e.g., open/done) and a longer-term "Projects backlog" input into summaries.

---

## Categories

All notes are classified into exactly one bucket:

| Category | Description |
|----------|-------------|
| **Ideas** | Shower thoughts, product concepts, things to explore |
| **Projects** | Active work—deliverables, tasks with deadlines |
| **Family** | Spouse, kids, household, family logistics |
| **Friends** | People to reach out to, social commitments |
| **Health** | Exercise, diet, medical, mental health |
| **Admin** | Bills, appointments, errands, life maintenance |
| **Uncategorized** | Couldn't classify confidently, or files without a chosen category |

Categories are hardcoded for MVP. No settings screen to customize.

---

## Data Model

```
User:
  - id: uuid
  - email: string
  - timezone: string (e.g., "America/New_York")
  - created_at: timestamp

Device:
  - id: uuid
  - user_id: uuid (FK)
  - platform: enum (android | web)
  - push_token: string (FCM token, nullable)
  - last_seen_at: timestamp
  - created_at: timestamp

Note:
  - id: uuid
  - user_id: uuid (FK)
  - created_at: timestamp
  - updated_at: timestamp
  - type: enum (text | voice | file)
  - content: string (text or transcript)
  - attachments: [{filename, mime_type, storage_path, size_bytes}] (for voice, may include original audio file)
  - category: enum (ideas | projects | family | friends | health | admin | uncategorized)
  - classification_confidence: float (0.0-1.0, nullable for manual category selection)
  - classification_status: enum (pending | completed | failed | manual)

DailySummary:
  - id: uuid
  - user_id: uuid (FK)
  - generated_at: timestamp
  - summary_date: date
  - content: text (the generated summary)
  - sent_at: timestamp (nullable, when push was delivered)
```

---

## Classification Pipeline

```
[Capture]
    ↓ (sync)
[Save to DB with category=uncategorized, status=pending]
    ↓ (async job triggered)
[If voice: transcribe via Whisper/Deepgram]
    ↓
[If file: set category (chosen or uncategorized), status=manual, DONE]
    ↳ (else) [LLM classification call]
    - 3 retries with exponential backoff on failure
    - If all retries fail: mark uncategorized, status=failed
    ↓
[Update note with category + confidence, status=completed]
```

**LLM Prompt:**
```
Classify this note into exactly one category. Return JSON only.

Categories:
- ideas: Shower thoughts, product concepts, things to explore
- projects: Active work tasks, deliverables
- family: Spouse, kids, household
- friends: Social relationships, people to reach out to
- health: Exercise, diet, medical, mental health
- admin: Bills, appointments, errands, life maintenance
- uncategorized: Doesn't fit cleanly

Note content:
"""
{content}
"""

Return: {"category": "<category>", "confidence": <0.0-1.0>}
```

---

## Authentication & Authorization

- **Auth provider:** Supabase Auth (email/password or magic link)
- **Single-user MVP:** Only one account, but auth protects data if URL is accessed by others
- **All data is user-scoped:** Row-level security on all tables

---

## Constraints & Limits

| Constraint | Limit |
|------------|-------|
| File upload size | 10 MB max per file |
| Allowed file types | PDF, PNG, JPG, JPEG, GIF, WEBP, DOC, DOCX, TXT |
| Voice recording length | 5 minutes max |
| Timezone | User-configured in settings (auto-detected on first app open) |

---

## Tech Stack

| Layer | Choice |
|-------|--------|
| **Android** | Flutter (or Expo for shared codebase) |
| **Web** | React |
| **Backend** | Supabase (auth, Postgres, storage, edge functions) |
| **Transcription** | Whisper API or Deepgram (async) |
| **Classification** | Claude Haiku API (cost-optimized) |
| **Push Notifications** | Firebase Cloud Messaging |
| **Background Jobs** | Supabase Edge Functions + pg_cron for scheduled tasks |

---

## MVP Scope

### In Scope

- [ ] User authentication (email/password or magic link)
- [ ] Mobile capture: text, voice, share sheet, widget
- [ ] Web capture: text, paste, file drag-and-drop
- [ ] Async transcription for voice notes (max 5 min)
- [ ] Async AI classification for text/voice (3 retries, then uncategorized)
- [ ] Manual category selection for file uploads
- [ ] Web view with reverse-chron feed
- [ ] Category filter
- [ ] Full-text search
- [ ] Inline attachment preview
- [ ] Manual category editing (single tap)
- [ ] Daily summary push notification at 8am (mobile only, pre-generated via cron)
- [ ] Timezone settings (auto-detect + manual override)
- [ ] Classification confidence stored for future use

### Out of Scope (Post-MVP)

- Email fallback for daily summary (for web-only users)
- MCP/API access for external querying
- Weekly review module
- Bouncer (confidence threshold with "needs review" nudges)
- Fix button (inline correction prompts)
- Semantic search
- Transcript editing
- Collaboration/sharing
- End-to-end encryption
- Rich text editor
- Offline-first sync
- Custom categories
- Structure within categories (e.g., "next action" field for projects)
- Explicit task states (e.g., open/done) for Projects notes
- Multi-user support

---

## Success Criteria

1. **Daily usage:** Replace ad-hoc note dumping into Claude Projects
2. **Capture speed:** Note visible in feed within 5 seconds (classification completes async)
3. **Summary utility:** Daily summary is read and influences the day's priorities
4. **Classification accuracy:** Categories feel right >80% of the time without manual correction

---

## Architecture Notes

The daily summary system is built as the first "module" in a notification framework that can later support:
- Weekly reviews
- Context-specific digests
- Reminder nudges for stale items

This modular approach allows adding new proactive features without rearchitecting.
